import { describe, it, expect, beforeAll, beforeEach, afterEach, afterAll } from '@ohos/hypium';
import { DataManager, Transaction, Category, BalanceSummary } from '../../main/ets/services/DataManager';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { BusinessError } from '@ohos/base';

/**
 * DataManager å•å…ƒæµ‹è¯• - ä¼˜åŒ–ç‰ˆ
 * åŸºäºåä¸º HarmonyOS å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ
 * 
 * å‘½åè§„èŒƒ: test0XX_[åŠŸèƒ½]_[åœºæ™¯]_[é¢„æœŸç»“æœ]
 * æµ‹è¯•åŸåˆ™: ç‹¬ç«‹ã€å¯é‡å¤ã€å¿«é€Ÿã€è‡ªéªŒè¯
 */
export default function DataManagerOptimizedTest() {
  
  describe('DataManager Optimized Unit Test', () => {
    
    // ==================== æµ‹è¯•é…ç½® ====================
    const TEST_TAG = 'DataManagerOptTest';
    const MAX_TIMEOUT = 5000; // æœ€å¤§è¶…æ—¶æ—¶é—´ 5s
    
    let dataManager: DataManager;
    let testContext: Context;
    let testIdCounter: number = 1;
    
    /**
     * ç”Ÿæˆå”¯ä¸€æµ‹è¯•ID
     */
    function generateTestId(): number {
      return Date.now() + (testIdCounter++);
    }
    
    /**
     * åˆ›å»ºæ ‡å‡†æµ‹è¯•äº¤æ˜“æ•°æ®
     */
    function createTestTransaction(overrides: Partial<Transaction> = {}): Transaction {
      return {
        id: generateTestId(),
        title: 'æµ‹è¯•äº¤æ˜“',
        amount: 100,
        type: 'expense',
        date: '2026-02-03',
        category: 'é¤é¥®',
        ...overrides
      };
    }
    
    // ==================== ç”Ÿå‘½å‘¨æœŸé’©å­ ====================
    
    beforeAll(async () => {
      hilog.info(0x0000, TEST_TAG, 'ã€æµ‹è¯•å¥—ä»¶åˆå§‹åŒ–ã€‘å¼€å§‹è®¾ç½®æµ‹è¯•ç¯å¢ƒ');
      
      try {
        dataManager = DataManager.getInstance();
        testContext = getContext(this);
        
        if (!testContext) {
          throw new Error('æµ‹è¯•ä¸Šä¸‹æ–‡è·å–å¤±è´¥');
        }
        
        await dataManager.init(testContext);
        hilog.info(0x0000, TEST_TAG, 'âœ… DataManager åˆå§‹åŒ–æˆåŠŸ');
      } catch (err) {
        const error = err as BusinessError;
        hilog.error(0x0000, TEST_TAG, 'âŒ æµ‹è¯•å¥—ä»¶åˆå§‹åŒ–å¤±è´¥: %{public}s', error.message);
        throw err;
      }
    });

    beforeEach(async () => {
      // é‡ç½®è®¡æ•°å™¨
      testIdCounter = 1;
      
      // æ¸…ç†æµ‹è¯•æ•°æ®ï¼Œç¡®ä¿æµ‹è¯•ç‹¬ç«‹æ€§
      try {
        await dataManager.saveTransactions([]);
        hilog.debug(0x0000, TEST_TAG, 'ğŸ§¹ æµ‹è¯•æ•°æ®å·²æ¸…ç†');
      } catch (err) {
        hilog.warn(0x0000, TEST_TAG, 'âš ï¸ æµ‹è¯•æ•°æ®æ¸…ç†å¤±è´¥ï¼Œå¯èƒ½å½±å“æµ‹è¯•ç‹¬ç«‹æ€§');
      }
    });

    afterEach(async () => {
      // å†æ¬¡æ¸…ç†ï¼Œç¡®ä¿æ— å‰¯ä½œç”¨
      try {
        await dataManager.saveTransactions([]);
      } catch (err) {
        // æ¸…ç†å¤±è´¥ä¸å½±å“æµ‹è¯•é€šè¿‡
      }
    });

    afterAll(() => {
      hilog.info(0x0000, TEST_TAG, 'ã€æµ‹è¯•å¥—ä»¶å®Œæˆã€‘æ‰€æœ‰æµ‹è¯•æ‰§è¡Œå®Œæ¯•');
    });

    // ==================== åŸºç¡€åŠŸèƒ½æµ‹è¯• ====================
    
    describe('ã€test001-010ã€‘åŸºç¡€åŠŸèƒ½æµ‹è¯•', () => {
      
      /**
       * test001: å•ä¾‹æ¨¡å¼éªŒè¯
       * å‰æ: ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
       * æ“ä½œ: å¤šæ¬¡è·å– DataManager å®ä¾‹
       * é¢„æœŸ: æ‰€æœ‰å®ä¾‹å¼•ç”¨ç›¸åŒ
       */
      it('test001_singleton_instance_should_be_same', 0, () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test001: å•ä¾‹æ¨¡å¼éªŒè¯');
        
        const instance1 = DataManager.getInstance();
        const instance2 = DataManager.getInstance();
        
        expect(instance1).assertNotNull();
        expect(instance2).assertNotNull();
        expect(instance1 === instance2).assertTrue();
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test001 é€šè¿‡: å•ä¾‹æ¨¡å¼å·¥ä½œæ­£å¸¸');
      });

      /**
       * test002: æ·»åŠ å•ç¬”äº¤æ˜“
       * å‰æ: DataManager å·²åˆå§‹åŒ–
       * æ“ä½œ: æ·»åŠ ä¸€æ¡äº¤æ˜“è®°å½•
       * é¢„æœŸ: æ•°æ®æˆåŠŸä¿å­˜ï¼Œå¯æ­£ç¡®æŸ¥è¯¢
       */
      it('test002_add_transaction_should_success', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test002: æ·»åŠ å•ç¬”äº¤æ˜“');
        
        const transaction = createTestTransaction({
          title: 'åˆé¤',
          amount: 35,
          category: 'é¤é¥®'
        });

        const startTime = Date.now();
        const result = await dataManager.addTransaction(transaction);
        const duration = Date.now() - startTime;

        expect(result).assertTrue();
        expect(duration).assertLess(500); // æ€§èƒ½è¦æ±‚: <500ms

        // éªŒè¯æ•°æ®å·²ä¿å­˜
        const transactions = await dataManager.getTransactions();
        expect(transactions.length).assertEqual(1);
        expect(transactions[0].title).assertEqual('åˆé¤');
        expect(transactions[0].amount).assertEqual(35);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test002 é€šè¿‡: æ·»åŠ äº¤æ˜“è€—æ—¶ %{public}d ms', duration);
      });

      /**
       * test003: æŸ¥è¯¢äº¤æ˜“åˆ—è¡¨
       * å‰æ: å·²æ·»åŠ å¤šæ¡äº¤æ˜“
       * æ“ä½œ: æŸ¥è¯¢æ‰€æœ‰äº¤æ˜“
       * é¢„æœŸ: è¿”å›æ­£ç¡®çš„äº¤æ˜“åˆ—è¡¨ï¼ŒæŒ‰æ—¶é—´å€’åº
       */
      it('test003_get_transactions_should_return_correct_list', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test003: æŸ¥è¯¢äº¤æ˜“åˆ—è¡¨');
        
        // å‡†å¤‡æ•°æ®
        const t1 = createTestTransaction({ id: 1001, title: 'ç¬¬ä¸€æ¡' });
        const t2 = createTestTransaction({ id: 1002, title: 'ç¬¬äºŒæ¡' });
        const t3 = createTestTransaction({ id: 1003, title: 'ç¬¬ä¸‰æ¡' });
        
        await dataManager.addTransaction(t1);
        await dataManager.addTransaction(t2);
        await dataManager.addTransaction(t3);

        const transactions = await dataManager.getTransactions();
        
        expect(transactions.length).assertEqual(3);
        // éªŒè¯å€’åºæ’åˆ—ï¼ˆæœ€æ–°æ·»åŠ çš„åœ¨æœ€å‰ï¼‰
        expect(transactions[0].id).assertEqual(1003);
        expect(transactions[1].id).assertEqual(1002);
        expect(transactions[2].id).assertEqual(1001);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test003 é€šè¿‡: æŸ¥è¯¢åˆ° %{public}d æ¡äº¤æ˜“', transactions.length);
      });

      /**
       * test004: æ›´æ–°äº¤æ˜“è®°å½•
       * å‰æ: å·²å­˜åœ¨äº¤æ˜“è®°å½•
       * æ“ä½œ: æ›´æ–°äº¤æ˜“ä¿¡æ¯
       * é¢„æœŸ: æ•°æ®æ›´æ–°æˆåŠŸï¼ŒæŸ¥è¯¢è¿”å›æ–°å€¼
       */
      it('test004_update_transaction_should_modify_data', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test004: æ›´æ–°äº¤æ˜“è®°å½•');
        
        const original = createTestTransaction({
          id: 2001,
          title: 'åŸæ•°æ®',
          amount: 50
        });
        await dataManager.addTransaction(original);

        const updated = createTestTransaction({
          id: 2001,
          title: 'ä¿®æ”¹å',
          amount: 75,
          category: 'äº¤é€š'
        });

        const result = await dataManager.updateTransaction(updated);
        expect(result).assertTrue();

        const transactions = await dataManager.getTransactions();
        expect(transactions[0].title).assertEqual('ä¿®æ”¹å');
        expect(transactions[0].amount).assertEqual(75);
        expect(transactions[0].category).assertEqual('äº¤é€š');
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test004 é€šè¿‡: æ•°æ®æ›´æ–°æˆåŠŸ');
      });

      /**
       * test005: åˆ é™¤äº¤æ˜“è®°å½•
       * å‰æ: å·²å­˜åœ¨äº¤æ˜“è®°å½•
       * æ“ä½œ: åˆ é™¤æŒ‡å®šIDçš„äº¤æ˜“
       * é¢„æœŸ: æ•°æ®åˆ é™¤æˆåŠŸï¼Œä¸å†å‡ºç°åœ¨åˆ—è¡¨ä¸­
       */
      it('test005_delete_transaction_should_remove_data', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test005: åˆ é™¤äº¤æ˜“è®°å½•');
        
        const transaction = createTestTransaction({ id: 3001 });
        await dataManager.addTransaction(transaction);
        
        let transactions = await dataManager.getTransactions();
        expect(transactions.length).assertEqual(1);

        const result = await dataManager.deleteTransaction(3001);
        expect(result).assertTrue();

        transactions = await dataManager.getTransactions();
        expect(transactions.length).assertEqual(0);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test005 é€šè¿‡: æ•°æ®åˆ é™¤æˆåŠŸ');
      });
    });

    // ==================== ä¸šåŠ¡é€»è¾‘æµ‹è¯• ====================
    
    describe('ã€test011-020ã€‘ä¸šåŠ¡é€»è¾‘æµ‹è¯•', () => {
      
      /**
       * test011: è®¡ç®—æ€»æ”¶å…¥
       * å‰æ: å·²æ·»åŠ å¤šç¬”æ”¶å…¥
       * æ“ä½œ: è°ƒç”¨ calculateBalance
       * é¢„æœŸ: è¿”å›æ­£ç¡®çš„æ€»æ”¶å…¥
       */
      it('test011_calculate_total_income_should_be_correct', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test011: è®¡ç®—æ€»æ”¶å…¥');
        
        await dataManager.addTransaction(createTestTransaction({
          type: 'income', amount: 5000, category: 'å·¥èµ„'
        }));
        await dataManager.addTransaction(createTestTransaction({
          type: 'income', amount: 1000, category: 'å¥–é‡‘'
        }));
        await dataManager.addTransaction(createTestTransaction({
          type: 'expense', amount: 200, category: 'é¤é¥®'
        }));

        const summary = await dataManager.calculateBalance();
        
        expect(summary.totalIncome).assertEqual(6000);
        expect(summary.totalExpense).assertEqual(200);
        expect(summary.balance).assertEqual(5800);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test011 é€šè¿‡: ä½™é¢è®¡ç®—æ­£ç¡®');
      });

      /**
       * test012: åˆ†ç±»ç®¡ç†
       * å‰æ: ç³»ç»Ÿé¦–æ¬¡è¿è¡Œ
       * æ“ä½œ: è·å–åˆ†ç±»åˆ—è¡¨
       * é¢„æœŸ: è¿”å›é»˜è®¤åˆ†ç±»
       */
      it('test012_get_categories_should_return_defaults', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test012: è·å–é»˜è®¤åˆ†ç±»');
        
        const categories = await dataManager.getCategories();
        
        expect(categories.length).assertLarger(0);
        
        const expenseCategories = categories.filter(c => c.type === 'expense');
        const incomeCategories = categories.filter(c => c.type === 'income');
        
        expect(expenseCategories.length).assertLarger(0);
        expect(incomeCategories.length).assertLarger(0);
        
        // éªŒè¯æ¯ä¸ªåˆ†ç±»éƒ½æœ‰åç§°å’Œå›¾æ ‡
        categories.forEach(cat => {
          expect(cat.name.length).assertLarger(0);
          expect(cat.icon.length).assertLarger(0);
        });
        
        hilog.info(0x0000, TEST_TAG, 
          'âœ… test012 é€šè¿‡: è·å– %{public}d ä¸ªåˆ†ç±»ï¼ˆæ”¯å‡º%{public}dï¼Œæ”¶å…¥%{public}dï¼‰',
          categories.length, expenseCategories.length, incomeCategories.length
        );
      });

      /**
       * test013: ä¿å­˜è‡ªå®šä¹‰åˆ†ç±»
       * å‰æ: æ— 
       * æ“ä½œ: ä¿å­˜è‡ªå®šä¹‰åˆ†ç±»åˆ—è¡¨
       * é¢„æœŸ: ä¿å­˜æˆåŠŸï¼Œå¯æ­£ç¡®è¯»å–
       */
      it('test013_save_custom_categories_should_persist', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test013: ä¿å­˜è‡ªå®šä¹‰åˆ†ç±»');
        
        const customCategories: Category[] = [
          { name: 'æµ‹è¯•æ”¯å‡º1', icon: 'ğŸ¯', type: 'expense' },
          { name: 'æµ‹è¯•æ”¶å…¥1', icon: 'ğŸ’', type: 'income' }
        ];

        const saveResult = await dataManager.saveCategories(customCategories);
        expect(saveResult).assertTrue();

        const retrieved = await dataManager.getCategories();
        expect(retrieved.length).assertEqual(2);
        expect(retrieved[0].name).assertEqual('æµ‹è¯•æ”¯å‡º1');
        expect(retrieved[1].name).assertEqual('æµ‹è¯•æ”¶å…¥1');
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test013 é€šè¿‡: è‡ªå®šä¹‰åˆ†ç±»ä¿å­˜æˆåŠŸ');
      });
    });

    // ==================== è¾¹ç•Œæ¡ä»¶æµ‹è¯• ====================
    
    describe('ã€test021-030ã€‘è¾¹ç•Œæ¡ä»¶æµ‹è¯•', () => {
      
      /**
       * test021: é›¶é‡‘é¢äº¤æ˜“
       * è¾¹ç•Œ: amount = 0
       * é¢„æœŸ: æ­£ç¡®å¤„ç†ï¼Œæ— å¼‚å¸¸
       */
      it('test021_zero_amount_transaction_should_handle', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test021: é›¶é‡‘é¢äº¤æ˜“');
        
        const transaction = createTestTransaction({ amount: 0 });
        
        const result = await dataManager.addTransaction(transaction);
        expect(result).assertTrue();

        const summary = await dataManager.calculateBalance();
        expect(summary.totalExpense).assertEqual(0);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test021 é€šè¿‡: é›¶é‡‘é¢å¤„ç†æ­£ç¡®');
      });

      /**
       * test022: å¤§é¢äº¤æ˜“
       * è¾¹ç•Œ: amount = 999999.99
       * é¢„æœŸ: æ­£ç¡®å¤„ç†ï¼Œç²¾åº¦ä¿æŒ
       */
      it('test022_large_amount_transaction_should_handle', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test022: å¤§é¢äº¤æ˜“');
        
        const transaction = createTestTransaction({
          type: 'income',
          amount: 999999.99
        });
        
        const result = await dataManager.addTransaction(transaction);
        expect(result).assertTrue();

        const summary = await dataManager.calculateBalance();
        expect(summary.totalIncome).assertEqual(999999.99);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test022 é€šè¿‡: å¤§é¢äº¤æ˜“å¤„ç†æ­£ç¡®');
      });

      /**
       * test023: ç©ºæ ‡é¢˜äº¤æ˜“
       * è¾¹ç•Œ: title = ''
       * é¢„æœŸ: å…è®¸ç©ºæ ‡é¢˜ï¼Œæ­£å¸¸ä¿å­˜
       */
      it('test023_empty_title_transaction_should_allow', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test023: ç©ºæ ‡é¢˜äº¤æ˜“');
        
        const transaction = createTestTransaction({ title: '' });
        
        const result = await dataManager.addTransaction(transaction);
        expect(result).assertTrue();

        const transactions = await dataManager.getTransactions();
        expect(transactions[0].title).assertEqual('');
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test023 é€šè¿‡: ç©ºæ ‡é¢˜å…è®¸');
      });

      /**
       * test024: ç‰¹æ®Šå­—ç¬¦æ ‡é¢˜
       * è¾¹ç•Œ: åŒ…å«ç‰¹æ®Šå­—ç¬¦
       * é¢„æœŸ: æ­£ç¡®å¤„ç†ï¼Œæ•°æ®å®Œæ•´ä¿å­˜
       */
      it('test024_special_characters_title_should_preserve', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test024: ç‰¹æ®Šå­—ç¬¦æ ‡é¢˜');
        
        const specialTitle = 'æµ‹è¯•!@#$%^&*()_+-=[]{}|;\':",./<>?';
        const transaction = createTestTransaction({ title: specialTitle });
        
        const result = await dataManager.addTransaction(transaction);
        expect(result).assertTrue();

        const transactions = await dataManager.getTransactions();
        expect(transactions[0].title).assertEqual(specialTitle);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test024 é€šè¿‡: ç‰¹æ®Šå­—ç¬¦å®Œæ•´ä¿ç•™');
      });

      /**
       * test025: é•¿æ ‡é¢˜
       * è¾¹ç•Œ: 100+ å­—ç¬¦
       * é¢„æœŸ: å®Œæ•´ä¿å­˜ï¼Œæ— æˆªæ–­
       */
      it('test025_long_title_should_preserve', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test025: é•¿æ ‡é¢˜');
        
        const longTitle = 'è¿™æ˜¯ä¸€ä¸ªéå¸¸éå¸¸é•¿çš„æ ‡é¢˜'.repeat(5); // 100+ å­—ç¬¦
        const transaction = createTestTransaction({ title: longTitle });
        
        const result = await dataManager.addTransaction(transaction);
        expect(result).assertTrue();

        const transactions = await dataManager.getTransactions();
        expect(transactions[0].title.length).assertEqual(longTitle.length);
        
        hilog.info(0x0000, TEST_TAG, 
          'âœ… test025 é€šè¿‡: é•¿æ ‡é¢˜ %{public}d å­—ç¬¦å®Œæ•´ä¿å­˜', 
          longTitle.length
        );
      });
    });

    // ==================== é”™è¯¯å¤„ç†æµ‹è¯• ====================
    
    describe('ã€test031-040ã€‘é”™è¯¯å¤„ç†æµ‹è¯•', () => {
      
      /**
       * test031: æ›´æ–°ä¸å­˜åœ¨çš„äº¤æ˜“
       * é”™è¯¯åœºæ™¯: ID ä¸å­˜åœ¨
       * é¢„æœŸ: è¿”å› falseï¼Œä¸æŠ›å‡ºå¼‚å¸¸
       */
      it('test031_update_nonexistent_should_return_false', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test031: æ›´æ–°ä¸å­˜åœ¨çš„æ•°æ®');
        
        const nonExistent = createTestTransaction({ id: 99999 });
        
        const result = await dataManager.updateTransaction(nonExistent);
        expect(result).assertFalse();
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test031 é€šè¿‡: æ­£ç¡®å¤„ç†ä¸å­˜åœ¨çš„æ•°æ®');
      });

      /**
       * test032: åˆ é™¤ä¸å­˜åœ¨çš„äº¤æ˜“
       * é”™è¯¯åœºæ™¯: ID ä¸å­˜åœ¨
       * é¢„æœŸ: è¿”å› trueï¼ˆå¹‚ç­‰ï¼‰ï¼Œæ— å‰¯ä½œç”¨
       */
      it('test032_delete_nonexistent_should_return_true', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test032: åˆ é™¤ä¸å­˜åœ¨çš„æ•°æ®');
        
        const result = await dataManager.deleteTransaction(99999);
        expect(result).assertTrue(); // å¹‚ç­‰æ“ä½œ
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test032 é€šè¿‡: å¹‚ç­‰åˆ é™¤æ­£å¸¸å·¥ä½œ');
      });

      /**
       * test033: æ•°æ®ä¸€è‡´æ€§ä¿éšœ
       * åœºæ™¯: æ“ä½œå¤±è´¥åæ•°æ®åº”ä¿æŒåŸæ ·
       */
      it('test033_data_integrity_after_failed_operation', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test033: æ•°æ®ä¸€è‡´æ€§');
        
        // å…ˆæ·»åŠ æœ‰æ•ˆæ•°æ®
        const validData = createTestTransaction({ id: 8888, title: 'æœ‰æ•ˆæ•°æ®' });
        await dataManager.addTransaction(validData);
        
        const beforeCount = (await dataManager.getTransactions()).length;
        
        // å°è¯•æ— æ•ˆæ“ä½œ
        await dataManager.updateTransaction(createTestTransaction({ id: 99999 }));
        
        const afterCount = (await dataManager.getTransactions()).length;
        expect(afterCount).assertEqual(beforeCount);
        
        // éªŒè¯åŸæœ‰æ•°æ®æœªå—å½±å“
        const transactions = await dataManager.getTransactions();
        expect(transactions[0].title).assertEqual('æœ‰æ•ˆæ•°æ®');
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test033 é€šè¿‡: æ•°æ®ä¸€è‡´æ€§ä¿éšœ');
      });
    });

    // ==================== æ€§èƒ½æµ‹è¯• ====================
    
    describe('ã€test041-050ã€‘æ€§èƒ½åŸºå‡†æµ‹è¯•', () => {
      
      /**
       * test041: å•æ¡æ·»åŠ æ€§èƒ½
       * åŸºå‡†: < 100ms
       */
      it('test041_single_add_performance', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test041: å•æ¡æ·»åŠ æ€§èƒ½æµ‹è¯•');
        
        const transaction = createTestTransaction();
        
        const start = Date.now();
        await dataManager.addTransaction(transaction);
        const duration = Date.now() - start;
        
        expect(duration).assertLess(100);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test041 é€šè¿‡: å•æ¡æ·»åŠ è€—æ—¶ %{public}d ms', duration);
      });

      /**
       * test042: æ‰¹é‡æ·»åŠ æ€§èƒ½ï¼ˆ10æ¡ï¼‰
       * åŸºå‡†: < 500ms
       */
      it('test042_batch_add_10_performance', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test042: æ‰¹é‡æ·»åŠ æ€§èƒ½ï¼ˆ10æ¡ï¼‰');
        
        const transactions = Array.from({ length: 10 }, (_, i) => 
          createTestTransaction({ id: 5000 + i, title: `æ€§èƒ½æµ‹è¯•${i}` })
        );

        const start = Date.now();
        for (const t of transactions) {
          await dataManager.addTransaction(t);
        }
        const duration = Date.now() - start;
        
        expect(duration).assertLess(500);
        
        hilog.info(0x0000, TEST_TAG, 
          'âœ… test042 é€šè¿‡: æ‰¹é‡æ·»åŠ 10æ¡è€—æ—¶ %{public}d msï¼ˆå¹³å‡ %{public}d ms/æ¡ï¼‰',
          duration, duration / 10
        );
      });

      /**
       * test043: æŸ¥è¯¢æ€§èƒ½
       * åŸºå‡†: 100æ¡æ•°æ® < 100ms
       */
      it('test043_query_performance_with_100_records', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test043: æŸ¥è¯¢æ€§èƒ½æµ‹è¯•ï¼ˆ100æ¡ï¼‰');
        
        // å‡†å¤‡æ•°æ®
        for (let i = 0; i < 100; i++) {
          await dataManager.addTransaction(createTestTransaction({ 
            id: 6000 + i,
            title: `æŸ¥è¯¢æµ‹è¯•${i}` 
          }));
        }

        const start = Date.now();
        const transactions = await dataManager.getTransactions();
        const queryDuration = Date.now() - start;
        
        expect(transactions.length).assertEqual(100);
        expect(queryDuration).assertLess(100);
        
        // è®¡ç®—ä½™é¢æ€§èƒ½
        const calcStart = Date.now();
        await dataManager.calculateBalance();
        const calcDuration = Date.now() - calcStart;
        
        expect(calcDuration).assertLess(50);
        
        hilog.info(0x0000, TEST_TAG, 
          'âœ… test043 é€šè¿‡: æŸ¥è¯¢ %{public}d ms, è®¡ç®— %{public}d ms',
          queryDuration, calcDuration
        );
      });
    });

    // ==================== å¹¶å‘æµ‹è¯• ====================
    
    describe('ã€test051-060ã€‘å¹¶å‘ä¸å‹åŠ›æµ‹è¯•', () => {
      
      /**
       * test051: å¿«é€Ÿè¿ç»­æ“ä½œ
       * åœºæ™¯: å¿«é€Ÿæ‰§è¡Œå¤šæ¬¡æ“ä½œ
       * é¢„æœŸ: æ•°æ®ä¸€è‡´æ€§ä¿æŒ
       */
      it('test051_rapid_successive_operations', 0, async () => {
        hilog.info(0x0000, TEST_TAG, 'â–¶ï¸ test051: å¿«é€Ÿè¿ç»­æ“ä½œ');
        
        const start = Date.now();
        
        // æ·»åŠ 
        await dataManager.addTransaction(createTestTransaction({ id: 7001 }));
        // ä¿®æ”¹
        await dataManager.updateTransaction(createTestTransaction({ id: 7001, amount: 200 }));
        // æ·»åŠ 
        await dataManager.addTransaction(createTestTransaction({ id: 7002 }));
        // åˆ é™¤
        await dataManager.deleteTransaction(7001);
        // æŸ¥è¯¢
        const transactions = await dataManager.getTransactions();
        
        const duration = Date.now() - start;
        
        expect(transactions.length).assertEqual(1);
        expect(transactions[0].id).assertEqual(7002);
        expect(duration).assertLess(1000);
        
        hilog.info(0x0000, TEST_TAG, 'âœ… test051 é€šè¿‡: è¿ç»­æ“ä½œè€—æ—¶ %{public}d ms', duration);
      });
    });

    // ==================== æµ‹è¯•å¥—ä»¶æ€»ç»“ ====================
    
    describe('ã€æ€»ç»“ã€‘æµ‹è¯•ç»Ÿè®¡', () => {
      
      /**
       * test099: æµ‹è¯•å¥—ä»¶éªŒè¯
       * éªŒè¯æµ‹è¯•æ¡†æ¶æ­£å¸¸å·¥ä½œ
       */
      it('test099_test_framework_validation', 0, () => {
        hilog.info(0x0000, TEST_TAG, 'ğŸ‰ æ‰€æœ‰æµ‹è¯•æ‰§è¡Œå®Œæ¯•ï¼');
        expect(true).assertTrue();
      });
    });
  });
}
